!function(){"use strict";App.ErrorHandler=function(a){return console.log(a)},App.ProcessEvents=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;for(a=a,j={},d={},g={},e=function(b){return console.log(b),b.console&&App.SaveConsoleRecord(a,b.console),b.vm&&App.SaveVMRecord(a,b.vm),b.pool&&App.SavePoolRecord(a,b.pool),b.message?App.CreateNotificationRecord(b.message):void 0},k=function(){},h=function(){},f=function(a){var b,c;switch(b=a["class"],c=a.ref,a.operation){case"mod":return j[b]||(j[b]={}),j[b][c]=a.snapshot;case"add":return d[b]||(d[b]={}),d[b][c]=a.snapshot;case"del":return g[b]||(g[b]={}),g[b][c]=a.snapshot}},l=0,m=b.length;m>l;l++)i=b[l],f(i);return e(d),k(j),h(g),c(null,a)},App.SavePoolRecord=function(a,b){var c,d,e,f,g;c=function(a,b,c,d){return App.Pools.find({poolUUID:a}).then(function(e){var f;return f=e.get("content").length,0===f?d(null,!0,c,b,a):d(null,e,c,b,a)})},e=function(a,d){return c(d.uuid,d,a,function(a,c,d,e){var f;return a?errorHandler(a):c===!0?(App.Global.set("pools",App.Global.get("pools")+1),App.Server.find({id:d}).then(function(a){var c;return b=App.Pools.createRecord({poolUUID:e.uuid,poolName:e.name_label}),c=a.get("content")[0].record,b.get("servers").pushObject(c),b.save(),c.set("pool",b),c.save()})):(f=c.get("content")[0].record,App.Server.find({id:d}).then(function(a){var b;return b=a.get("content")[0].record,b.set("pool",f),f.get("servers").pushObjects(a),f.save(),b.save()}))})},g=[];for(d in b)f=b[d],g.push(e(a,f));return g},App.SaveVMRecord=function(a,b){var c;return c=function(a,b,c){var d;return d=App.VM.createRecord({uuid:b.uuid,template:b.is_a_template,controlDomain:b.is_control_domain,power_state:b.power_state,name:b.name_label,description:b.name_description,vcpuStartup:b.VCPUs_at_startup,vcpuMax:b.VCPUs_max,memory_dynamic_max:b.memory_dynamic_max,memory_dynamic_min:b.memory_dynamic_min,memory_overhead:b.memory_overhead,memory_static_max:b.memory_static_max,memory_static_min:b.memory_static_min,memory_target:b.memory_target,metrics:b.metrics}),d.set("host",c),d.save()},App.Server.find({id:a}).then(function(d){var e,f,g;e=d.get("content")[0].record;for(f in b)g=b[f],c(a,g,e);return e.save()})},App.SaveConsoleRecord=function(){},App.CreateNotificationRecord=function(a){var b,c,d,e;c=function(a){var b;return b=App.Notification.createRecord({uuid:a.uuid,name:a.name,category:a.cls,body:a.body,priority:a.priority,referenceUuid:a.obj_uuid,timestamp:a.timestamp}),b.save()},e=[];for(b in a)d=a[b],e.push(c(d));return e},App.SaveHostRecord=function(a,b,c,d,e){var f;return f=App.Server.createRecord({uuid:"",hostUrl:a,hostName:b,hostPassword:c,hostToken:d}),App.Global.set("hosts",App.Global.get("hosts")+1),f.save(),f.one("didCreate",function(){return e(f.id)})},App.UpdateHostRecord=function(a,b,c){var d;return d=App.Server.find({id:a}).then(function(d){var e;return e=d.get("content")[0].record,e.set("hostToken",b),e.get("transaction").commit(),e.one("didUpdate",this,function(){return c(a)})})},App.EventsCheck=function(a,b,c,d,e,f){var g;return g=new XenAPI(b,c,a),g.init(function(a){return a?App.ErrorHandler(a):g.event.from([["*"],d,30.1],function(a,b){var c,g;return a?App.ErrorHandler(a):(c=d,g=b.token,c===g?Ember.Debug("No updates"):App.UpdateHostRecord(e,b.token,function(a){return App.ProcessEvents(a,b.events,f)}))})})},App.EventsInit=function(a,b,c,d){var e;return e=new XenAPI(b,c,a),e.init(function(f){return f?errorHandler(f):e.event.from([["*"],"",.1],function(e,f){return e?App.ErrorHandler(e):App.SaveHostRecord(a,b,c,f.token,function(a){return App.ProcessEvents(a,f.events,d)})})})}}.call(this),function(){"use strict";App.Scheduler=function(){var a,b,c,d,e;return a="5000",c={},d=function(){return Ember.debug("[Scheduler] Started scheduling"),a=setInterval(b,a)},b=function(){return App.Server.find({}).then(function(a){var b;return b=a.get("content"),b.forEach(function(a){var b;return b=a.record,c[b.get("id")]!==!0?(c[b.get("id")]=!0,Ember.debug("[Scheduler] Polling"),App.EventsCheck(b.get("hostUrl"),b.get("hostName"),b.get("hostPassword"),b.get("hostToken"),b.get("id"),function(a,b){return a?Ember.debug(a):(Ember.debug("[Scheduler] Polling Successfull"),c[b]=!1)})):void 0})})},e=function(){return clearInterval(this.interval)},d()}}.call(this);