!function(){"use strict";App.ErrorHandler=function(a){return console.log(a)},App.ProcessEvents=function(a,b){var c,d,e,f,g,h,i,j,k,l;for(a=a,i={},c={},f={},d=function(b){return b.console&&App.SaveConsoleRecord(a,b.console),b.pool&&App.SavePoolRecord(a,b.pool),b.vm?App.SaveVMRecord(a,b.vm):void 0},j=function(){},g=function(){},e=function(a){var b,d;switch(b=a["class"],d=a.ref,a.operation){case"mod":return i[b]||(i[b]={}),i[b][d]=a.snapshot;case"add":return c[b]||(c[b]={}),c[b][d]=a.snapshot;case"del":return f[b]||(f[b]={}),f[b][d]=a.snapshot}},k=0,l=b.length;l>k;k++)h=b[k],e(h);return d(c),j(i),g(f)},App.SavePoolRecord=function(a,b){var c,d,e,f,g;c=function(a,b,c,d){return App.Pools.find({poolUUID:a}).then(function(e){var f;return f=e.get("content").length,0===f?d(null,!0,c,b,a):d(null,e,c,b,a)})},e=function(a,d){return c(d.uuid,d,a,function(a,c,d,e){var f;return a?errorHandler(a):c===!0?(App.Global.set("pools",App.Global.get("pools")+1),App.Server.find({id:d}).then(function(a){var c;return b=App.Pools.createRecord({poolUUID:e.uuid,poolName:e.name_label}),c=a.get("content")[0].record,b.get("servers").pushObject(c),b.save(),c.set("pool",b),c.save()})):(f=c.get("content")[0].record,App.Server.find({id:d}).then(function(a){var b;return b=a.get("content")[0].record,b.set("pool",f),f.get("servers").pushObjects(a),f.save(),b.save()}))})},g=[];for(d in b)f=b[d],g.push(e(a,f));return g},App.SaveVMRecord=function(a,b){var c,d,e,f;d=function(a,c){return c.is_a_template!==!0?App.Server.find({id:a}).then(function(){return b=App.VM.createRecord}):void 0},f=[];for(c in b)e=b[c],f.push(d(a,e));return f},App.SaveConsoleRecord=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(console.log(d));return e},App.SaveHostRecord=function(a,b,c,d){var e;return e=App.Server.createRecord({hostUrl:a,hostName:b,hostPassword:c,hostToken:d}),App.Global.set("hosts",App.Global.get("hosts")+1),e.save(),e.id},App.EventsInit=function(a,b,c){var d;return d=new XenAPI(b,c,a),d.init(function(e){return e?errorHandler(e):d.event.from([["*"],"",.1],function(d,e){var f;return d?App.ErrorHandler(d):(f=App.SaveHostRecord(a,b,c,e.token),App.ProcessEvents(f,e.events))})})}}.call(this),function(){"use strict";App.Scheduler={start:function(){return App.Global.hosts>0?(Ember.debug("[Scheduler] Started scheduling"),this.interval=setInterval(this.poll,1e4)):void 0}.observes("App.Global.hosts"),poll:function(){return App.Server.find(),App.Server.find({}).then(function(){return Ember.debug("[Scheduler] Polling")})},stop:function(){return clearInterval(this.interval)}}}.call(this);